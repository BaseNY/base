<template name="messagingPost">
	<div class="messagingPost">
		<div id="message-{{this._id}}" contenteditable="true" class="messageText" placeholder="Send a message...">
			<div class="placeholder">Send a message...</div>
		</div><a href=""><div class="messageSend"><i class="fa fa-chevron-right"></i></div></a>
	</div>
</template>

<template name="messaging">
	<section class="messaging-container">
		{{> messagingSidebar}}
		{{> messagingConversation}}
	</section>
</template>

<template name="messagingSidebar">
	<div class="messaging-sidebar">
		{{#each conversations}}
			<a href="/messages/{{this._id}}" class="messaging-sidebar-item {{#if this.current}}current{{/if}}">
				<div class="messaging-sidebar-img">
					<img src="{{this.otherUser.profile.img}}">
				</div>
				<div class="messaging-sidebar-info">
					<span class="name">{{this.name}}</span>
					<br>
					{{#with offer}}
						<span>
							Offer for:
							<a href="/post/{{this.itemId}}">
								{{#if this.item.title}}
									{{this.item.title}}
								{{else}}
									{{this.item.description}}
								{{/if}}
							</a>
						</span>
					{{/with}}
				</div>
				<!--{{json this}}-->
			</a>
		{{else}}
			You don't have any conversations yet.
		{{/each}}
	</div>
</template>

<template name="messagingConversation">
	<div class="messaging-conversation">
		{{> messagingInfo}}
		<div class="messages-container">
			<div class="messaging-messages">
				{{#each messageGroups}}
					{{> message}}
				{{/each}}
			</div>
		</div>
		<div class="messaging-reply-container">
			<div class="message-reply-box">
				<div id="messaging-reply" contenteditable="true" class="message-reply-text" placeholder="Message..."></div>
				<footer>
					<div class="add-preview-container">
						<img id="add-preview" class="image-preview" src="" />
					</div>
					<input id="add-image" class="image-input" type="file" />
					<label for="add-image">
						<div class="photo-upload">
							<a href=""><i class="fa fa-camera"></i></a> Add Photos
						</div>
					</label>
					<h4>Press Enter to send</h4>

				</footer>
			</div>
		</div>
	</div>
</template>

<template name="message">
	<div class="message">
		<!--<div class="message-header">
			<div class="message-sender-name">{{this.senderName}}</div>
			<div class="message-time"></div>
		</div>
		<div class="message-text">{{this.text}}</div>-->
		<div class="left">
			<a href="/profile/{{sender._id}}">
				<img src="{{sender.profile.img}}" />
			</a>
		</div>
		<div class="middle">
			<h4><a href="/profile/{{sender._id}}">{{sender.profile.name}}</a>
			</h4>
			{{#each messages}}
				{{#if isText}}
					<span>{{this.text}}</span>
				{{else}}
					<a href="{{this.text}}" data-lightbox="image-{{this._id}}">
						<img src="{{this.text}}" />
					</a>
				{{/if}}
			{{/each}}
		</div>
		<div class="right">
			{{date}}
		</div>
	</div>
</template>

<template name="messagingInfo">
	<div class="messaging-info">
		{{#with conversation}}
			<a href="/profile/{{this.otherUser._id}}" class="messaging-info-name">
				{{this.otherUser.profile.name}}
			</a>
			{{#with offer}}
				<div>
					Offer for:
					<a href="/post/{{this.itemId}}">
						{{#if this.item.title}}
							{{this.item.title}}
						{{else}}
							{{this.item.description}}
						{{/if}}
					</a>
				</div>
			{{/with}}
		{{/with}}
	</div>
</template>
